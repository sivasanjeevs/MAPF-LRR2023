flowchart TD
    A["Start Server<br/>MAPFServer.cpp"] --> B["Load Configuration<br/>myproblem.json"]
    B --> C["Read Agent & Task Files<br/>.agents, .tasks"]
    C --> D["Initialize Planner<br/>LaCAM2"]
    D --> E["Start HTTP Listener<br/>Port 8080"]
    E --> F["Server Ready<br/>Waiting for connections"]
    
    G["Start Continuous Client<br/>continuous_client_example.py"] --> H["Initialize Empty Agent List"]
    H --> I["Health Check<br/>GET /health"]
    I --> J["Reset Server State<br/>POST /reset"]
    J --> K["Initial Handshake<br/>POST /plan with empty agents"]
    K --> L["Server Returns Initial State"]
    L --> M["Client Syncs Agent Data"]
    
    M --> N["Simulation Loop Start<br/>while True"]
    N --> O["Increment Timestep"]
    O --> P["Send Current Agent States<br/>POST /plan"]
    P --> Q["Server: Update Task Queue<br/>update_tasks_lifelong"]
    Q --> R["Server: Assign Tasks to Agents"]
    R --> S["Server: Calculate Paths<br/>planner.plan()"]
    S --> T["Server: Generate Actions<br/>for all agents"]
    T --> U["Server: Return Actions<br/>JSON response"]
    U --> V["Client: Update Agent States<br/>location & orientation"]
    V --> W["Client: Display Status<br/>Timestep & Tasks Completed"]
    W --> X["Wait 0.1 seconds"]
    X --> N
    
    Y["User Runs Task Client<br/>add_task_client.py"] --> Z["POST /add_task<br/>start & goal locations"]
    Z --> AA["Server: Validate Locations"]
    AA --> BB["Server: Create Task Object"]
    BB --> CC["Server: Add to Task Queue"]
    CC --> DD["Server: Confirm Success"]
    DD --> EE["Task Available for Next Heartbeat"]
    EE -.-> Q
    
    classDef serverProcess fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef clientProcess fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef taskProcess fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef loopProcess fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    
    class A,B,C,D,E,F,Q,R,S,T,U,AA,BB,CC,DD serverProcess
    class G,H,I,J,K,L,M,O,P,V,W,X clientProcess
    class Y,Z,EE taskProcess
    class N loopProcess